<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chat + Player Completo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#121212;color:#EEE;font-family:Arial,sans-serif;display:flex;flex-direction:column;height:100vh;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    #menuSetup,#namePrompt,#waitingApproval{padding:1rem;display:flex;flex-direction:column;gap:.5rem;align-items:center;text-align:center;}
    #mainUI{display:none;flex:1;flex-direction:row;max-width:1200px;margin:0 auto;position:relative;}
    @media(min-width:1600px){#mainUI{max-width:900px;margin:2rem auto;border:1px solid #444;border-radius:10px;box-shadow:0 0 20px #0008;}}
    @media(max-width:768px){
      #mainUI{flex-direction:column!important;width:100%!important;height:100vh!important;padding:.5rem!important;}
      #playerArea,#chatArea{width:100%!important;}
      #chatArea{height:150px!important;border-left:none!important;border-top:1px solid #333!important;margin-top:.5rem!important;}
    }
    #playerArea{flex:2;background:#222;display:flex;flex-direction:column;align-items:center;padding:1rem;position:relative;}
    video{width:100%;max-width:800px;border-radius:6px;background:#000;position:relative;z-index:1;}
    #controls{margin:1rem;display:flex;gap:.5rem;flex-wrap:wrap;position:relative;z-index:1;}
    .btn{background:#ff4500;border:none;color:#FFF;padding:.5rem 1rem;border-radius:5px;cursor:pointer;z-index:1;}
    #chatArea{flex:1;display:flex;flex-direction:column;background:#1f1f1f;border-left:1px solid #333;position:relative;}
    #chatLog{flex:1;overflow-y:auto;padding:.5rem;}
    #chatInputArea{padding:.5rem;display:flex;gap:.5rem;}
    #chatInput{flex:1;padding:.5rem;border-radius:4px;border:none;background:#222;color:#EEE;}
    #fileMenuModal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:9999;}
    #fileMenuContent{background:#333;padding:1.5rem;border-radius:8px;min-width:320px;display:flex;flex-direction:column;gap:.75rem;}
    #fileMenuContent button{background:#444;color:#fff;padding:.75rem;border:none;border-radius:5px;cursor:pointer;font-size:1rem;}
    #participantList{display:none;position:absolute;top:10px;right:10px;background:#2c2c2c;padding:1rem;border-radius:6px;z-index:10;max-height:400px;overflow-y:auto;}
    .participantItem{display:flex;align-items:center;justify-content:space-between;padding:.3rem 0;border-bottom:1px solid #444;}
    .participantItem:hover{background:#333;}
    .participantName{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .admin-controls{display:flex;gap:.3rem;}
    .admin-controls button{background:#444;border:none;color:#EEE;padding:.2rem .5rem;border-radius:4px;cursor:pointer;font-size:.8rem;}
    .admin-controls .danger{background:#a00;}
    .modal-menu{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#222;border:1px solid #555;padding:1rem;border-radius:8px;display:none;z-index:10000;}
    .modal-menu.visible{display:block;}
    .modal-menu h3{margin-bottom:1rem;}
    .modal-menu .option{margin:.3rem 0;padding:.5rem;background:#444;color:#FFF;border-radius:4px;text-align:center;cursor:pointer;}
    .modal-menu .option.danger{background:#a00;}
  </style>
</head>
<body>
  <!-- HTML COMPLETO FOI OMITIDO AQUI PARA FOCO NA ATUALIZAÇÃO. -->

  <!-- Modal Punição -->
  <div id="punishModal" class="modal-menu">
    <h3>Aplicar ação a <span id="punishUserName"></span></h3>
    <div>
      <div class="option" data-time="5m">5 minutos</div>
      <div class="option" data-time="10m">10 minutos</div>
      <div class="option" data-time="30m">30 minutos</div>
      <div class="option" data-time="50m">50 minutos</div>
      <div class="option" data-time="1h">1 hora</div>
      <div class="option" data-time="2h">2 horas</div>
      <div class="option" data-time="3h">3 horas</div>
      <div class="option danger" data-time="indef">Até desativar</div>
      <div class="option danger" data-time="perm">Permanentemente</div>
    </div>
    <div style="margin-top:1rem;text-align:center;">
      <button id="closePunish" class="btn">Fechar</button>
    </div>
  </div>

  <!-- Modal de Aprovação -->
  <div id="approveModal" class="modal-menu">
    <h3><span id="approveUserName"></span> quer entrar na sala.</h3>
    <div style="margin-top:1rem;text-align:center;">
      <button id="approveAccept" class="btn">Aceitar</button>
      <button id="approveDeny" class="btn danger">Negar</button>
    </div>
  </div>

  <script>
    const approveModal = document.getElementById('approveModal');
    const approveUserName = document.getElementById('approveUserName');
    const approveAccept = document.getElementById('approveAccept');
    const approveDeny = document.getElementById('approveDeny');

    function handleJoinRequest(conn, data) {
      pendingRequests[conn.peer] = { conn, name: data.name };
      approveUserName.textContent = data.name;
      approveModal.dataset.peer = conn.peer;
      approveModal.classList.add('visible');
    }

    approveAccept.onclick = () => {
      const peerId = approveModal.dataset.peer;
      const user = pendingRequests[peerId];
      if (user) {
        user.conn.send({ type: 'joinAccept' });
        connList[peerId] = { conn: user.conn, name: user.name };
        updateParticipantUI();
        appendChat('[Sistema] ' + user.name + ' entrou na sala.');
        delete pendingRequests[peerId];
      }
      approveModal.classList.remove('visible');
    };

    approveDeny.onclick = () => {
      const peerId = approveModal.dataset.peer;
      const user = pendingRequests[peerId];
      if (user) {
        user.conn.send({ type: 'joinDeny' });
        appendChat('[Sistema] Entrada negada para ' + user.name + '.');
        delete pendingRequests[peerId];
      }
      approveModal.classList.remove('visible');
    };
  </script>
</body>
</html>
