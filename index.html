<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Player de Áudio e Vídeo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:#121212;color:#EEE;font-family:Arial,sans-serif}
    .container{display:flex;height:100%}
    @media(min-width:1200px){.container{flex-direction:row}#playerArea{width:70%}#playlistArea{width:15%}#chatArea{width:15%}}
    @media(min-width:768px)and(max-width:1199px){.container{flex-direction:row}#playerArea,#playlistArea,#chatArea{flex:1}}
    @media(max-width:767px){.container{flex-direction:column}#playlistArea{position:fixed;bottom:0;left:0;width:100%;height:180px;border-top:1px solid #333;transform:translateY(100%);transition:transform .3s}#playlistArea.active{transform:translateY(0)}#chatArea{display:none}}
    #playerArea{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem}
    video,audio,iframe{width:100%;max-width:800px;max-height:100vh;background:#000;border-radius:6px}
    #controls{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center}
    button{background:#ff4500;border:none;padding:.5rem 1rem;border-radius:5px;color:#FFF;cursor:pointer}
    #pipBtn{padding:.5rem;border-radius:5px;background:#ff4500;border:none;color:#FFF;cursor:pointer}
    #inputArea{margin-top:1rem;display:flex;gap:.5rem;width:100%;max-width:800px}
    #linkInput{flex:1;padding:.5rem;border-radius:4px;border:none;background:#222;color:#EEE}
    #playlistArea,#chatArea{background:#1f1f1f;overflow-y:auto;border-left:1px solid #333}
    #playlistHeader{display:flex;justify-content:space-between;align-items:center;padding:.5rem}
    #clearQueueBtn{background:#c03;padding:.25rem .5rem;font-size:.9rem;border-radius:4px}
    #playlistList{padding:.5rem}
    .playlist-item{display:flex;align-items:center;gap:.5rem;background:#2a2a2a;margin-bottom:.5rem;border-radius:4px;padding:.5rem;position:relative;cursor:pointer}
    .playlist-item.active{background:#ff4500}
    .thumb{width:60px;height:45px;border-radius:4px;object-fit:cover;flex-shrink:0}
    .info{flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
    .remove-btn{position:absolute;top:50%;right:5px;transform:translateY(-50%);background:red;border:none;color:#FFF;border-radius:50%;width:20px;height:20px;font-size:14px;display:none;align-items:center;justify-content:center;cursor:pointer}
    .playlist-item:hover .remove-btn{display:flex}
    #menuBtn{position:fixed;bottom:10px;right:10px;width:40px;height:40px;border-radius:50%;background:#2a2a2a;display:flex;align-items:center;justify-content:center;color:#FFF;font-size:24px;border:none;cursor:pointer}
    #menuDropdown{display:none;position:fixed;bottom:60px;right:10px;background:#2a2a2a;border-radius:5px;padding:.5rem}
    #menuDropdown button,#menuDropdown label{display:block;background:none;border:none;color:#FFF;padding:.5rem;text-align:left;cursor:pointer}
    #menuDropdown button:hover,#menuDropdown label:hover{background:#444}
    #debugBox{display:none;position:fixed;bottom:0;left:0;background:#333;color:#CCC;padding:.5rem;font-family:monospace;font-size:.8rem;max-width:300px;max-height:200px;overflow-y:auto;border-top-right-radius:6px}
  </style>
</head>
<body>
  <!-- corpo HTML mantido -->
  <script>
    async function fetchYouTubePlaylistItems(playlistUrl) {
      const playlistIdMatch = playlistUrl.match(/[?&]list=([a-zA-Z0-9_-]+)/);
      if (!playlistIdMatch) return [];
      const playlistId = playlistIdMatch[1];
      const proxy = "https://yt.lemnoslife.com/noKey/playlistItems?playlistId=" + playlistId;
      try {
        const res = await fetch(proxy);
        const data = await res.json();
        if (!data || !data.items) return [];
        return data.items.map(item => ({
          type: 'link',
          src: `https://www.youtube.com/watch?v=${item.videoId}`,
          title: item.title,
          thumb: item.thumbnails?.default?.url || ''
        }));
      } catch (err) {
        console.error("Erro ao buscar playlist:", err);
        return [];
      }
    }

    function playItem(i) {
      currentIndex = i;
      const item = playlist[i];
      mediaPlayer.style.display = 'none';
      audioPlayer.style.display = 'none';
      const oldIframe = document.getElementById('youtubePlayer');
      if (oldIframe) oldIframe.remove();
      mediaPlayer.pause();
      audioPlayer.pause();

      if (item.type === 'file') {
        const url = URL.createObjectURL(item.file);
        if (item.file.type.startsWith('video')) {
          mediaPlayer.src = url;
          mediaPlayer.style.display = 'block';
          mediaPlayer.play();
        } else {
          audioPlayer.src = url;
          audioPlayer.style.display = 'block';
          audioPlayer.play();
        }
      } else if (item.src.includes("youtube.com") || item.src.includes("youtu.be")) {
        const iframe = document.createElement('iframe');
        iframe.id = 'youtubePlayer';
        iframe.allowFullscreen = true;
        iframe.style.width = '100%';
        iframe.style.maxWidth = '800px';
        iframe.style.height = '450px';
        iframe.style.border = 'none';
        iframe.style.borderRadius = '6px';

        let embedUrl = '';
        if (item.src.includes('/shorts/')) {
          const id = item.src.split('/shorts/')[1].split('?')[0];
          embedUrl = `https://www.youtube.com/embed/${id}`;
        } else if (item.src.includes('watch?v=')) {
          const id = new URL(item.src).searchParams.get("v");
          embedUrl = `https://www.youtube.com/embed/${id}?autoplay=1`;
        } else if (item.src.includes('youtu.be/')) {
          const id = item.src.split('youtu.be/')[1].split('?')[0];
          embedUrl = `https://www.youtube.com/embed/${id}?autoplay=1`;
        }

        iframe.src = embedUrl;
        document.getElementById('playerArea').prepend(iframe);
      } else {
        mediaPlayer.src = item.src;
        mediaPlayer.style.display = 'block';
        mediaPlayer.play();
      }

      renderPlaylist();
    }

    sendLinkBtn.onclick = async () => {
      const url = linkInput.value.trim();
      if (!url) return;
      if (url.includes("list=")) {
        const items = await fetchYouTubePlaylistItems(url);
        playlist.push(...items);
        if (currentIndex === -1 && items.length > 0) playItem(0);
        else renderPlaylist();
      } else {
        playlist.push({ type: 'link', src: url, title: url });
        if (currentIndex === -1) playItem(0);
        else renderPlaylist();
      }
      linkInput.value = '';
    };
  </script>
</body>
</html>
