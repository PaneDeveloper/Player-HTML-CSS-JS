<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Chat + Player Completo</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:#121212;color:#EEE;font-family:Arial,sans-serif;display:flex;flex-direction:column;height:100vh;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    #menuSetup,#namePrompt,#waitingApproval,#rejectedNotice{padding:1rem;display:flex;flex-direction:column;gap:.5rem;align-items:center;text-align:center;}
    #mainUI{display:none;flex:1;flex-direction:row;max-width:1200px;margin:0 auto;position:relative;}
    @media(min-width:1600px){#mainUI{max-width:900px;margin:2rem auto;border:1px solid #444;border-radius:10px;box-shadow:0 0 20px #0008;}}
    @media(max-width:768px){
      #mainUI{flex-direction:column!important;width:100%!important;height:100vh!important;padding:.5rem!important;}
      #playerArea,#chatArea{width:100%!important;}
      #chatArea{height:150px!important;border-left:none!important;border-top:1px solid #333!important;margin-top:.5rem!important;}
    }
    #playerArea{flex:2;background:#222;display:flex;flex-direction:column;align-items:center;padding:1rem;position:relative;}
    video{width:100%;max-width:800px;border-radius:6px;background:#000;position:relative;z-index:1;}
    #controls{margin:1rem;display:flex;gap:.5rem;flex-wrap:wrap;position:relative;z-index:1;}
    .btn{background:#ff4500;border:none;color:#FFF;padding:.5rem 1rem;border-radius:5px;cursor:pointer;z-index:1;}
    #chatArea{flex:1;display:flex;flex-direction:column;background:#1f1f1f;border-left:1px solid #333;position:relative;}
    #chatLog{flex:1;overflow-y:auto;padding:.5rem;}
    #chatInputArea{padding:.5rem;display:flex;gap:.5rem;}
    #chatInput{flex:1;padding:.5rem;border-radius:4px;border:none;background:#222;color:#EEE;}
    #fileMenuModal,#participantListModal,#playlistModal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.75);display:none;justify-content:center;align-items:center;z-index:9999;}
    #fileMenuContent,#participantListContent,#playlistContent{background:#333;padding:1.5rem;border-radius:8px;min-width:320px;display:flex;flex-direction:column;gap:.75rem;position:relative;max-height:90vh;overflow-y:auto;}
    #fileMenuContent button,#participantListContent .admin-controls button,.playlistItem{background:#444;color:#fff;padding:.75rem;border:none;border-radius:5px;cursor:pointer;font-size:1rem;}
    #participantListContent .admin-controls .danger{background:#a00;}
    .closeBtn{position:absolute;top:10px;right:10px;background:#a00;color:#fff;border:none;border-radius:50%;width:24px;height:24px;font-weight:bold;cursor:pointer;}
    .playlistItem{display:flex;justify-content:space-between;align-items:center;padding:.5rem;margin-bottom:.3rem;background:#2a2a2a;}
    .playlistItem span{flex:1;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .playlistItem small{opacity:0.7;}
    #rejectedNotice img {
      width: 64px;
      height: 64px;
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div id="menuSetup">
    <label for="roomCode" class="sr-only">CÃ³digo da sala</label>
    <input id="roomCode" placeholder="CÃ³digo da sala (ex: A91J)" maxlength="4" style="text-transform:uppercase" aria-label="Campo para inserir o cÃ³digo da sala" />
    <button id="createRoom" class="btn" aria-label="Criar uma nova sala e configurar o nome">Criar Sala</button>
    <button id="joinRoom" class="btn" aria-label="Entrar em uma sala existente com cÃ³digo">Entrar na Sala</button>
  </div>

  <div id="namePrompt" style="display:none;">
    <label for="nickname" class="sr-only">Nome de usuÃ¡rio</label>
    <input id="nickname" placeholder="Seu nome de usuÃ¡rio" aria-label="Campo para inserir o seu nome"/>
    <button id="enterRoom" class="btn" aria-label="Confirmar e entrar na sala">Entrar</button>
  </div>

  <div id="waitingApproval" style="display:none;">
    <img src="https://media.tenor.com/On7kvXhzml4AAAAj/loading-gif.gif" alt="Carregando" width="64" height="64"/>
    <p aria-live="assertive">Esperando o Administrador aceitar sua solicitaÃ§Ã£o...</p>
  </div>

  <div id="rejectedNotice" style="display:none; flex-direction: column; gap: 0.5rem; align-items: center;">
    <img src="https://img.freepik.com/free-icon/cancel_318-10762.jpg" alt="Recusado"/>
    <p>O Administrador (A) da sala recusou a sua solicitaÃ§Ã£o de entrada :(</p>
    <button id="retryEntryBtn" class="btn">Tentar novamente</button>
  </div>

  <div id="mainUI">
    <div id="playerArea">
      <video id="mediaPlayer" controls autoplay></video>
      <div id="controls">
        <button id="chooseMediaBtn" class="btn" aria-label="Abrir opÃ§Ãµes para adicionar mÃ­dia">Escolher Arquivo/Link/Tela</button>
        <button id="showPlaylistBtn" class="btn" aria-label="Ver lista de reproduÃ§Ã£o">ðŸ“ƒ Playlist</button>
        <button id="showParticipantsBtn" class="btn" aria-label="Mostrar participantes da sala">ðŸ‘¥ Participantes</button>
      </div>
    </div>
    <div id="chatArea">
      <div id="chatLog" aria-live="polite"></div>
      <div id="chatInputArea">
        <label for="chatInput" class="sr-only">Mensagem</label>
        <input id="chatInput" placeholder="Digite sua mensagem" autocomplete="off" aria-label="Campo de mensagem"/>
        <button id="sendChatBtn" class="btn" aria-label="Enviar mensagem">Enviar</button>
      </div>
    </div>
  </div>

  <div id="fileMenuModal">
    <div id="fileMenuContent">
      <button class="closeBtn" onclick="document.getElementById('fileMenuModal').style.display='none'" aria-label="Fechar menu de mÃ­dia">Ã—</button>
      <button id="selectFileBtn" aria-label="Escolher um arquivo de vÃ­deo ou Ã¡udio do seu dispositivo">Escolher do dispositivo</button>
      <button id="insertLinkBtn" aria-label="Inserir um link direto para o vÃ­deo">Inserir link</button>
      <button id="shareScreenBtn" aria-label="Transmitir a tela ao vivo">Transmitir Tela</button>
    </div>
  </div>

  <div id="participantListModal">
    <div id="participantListContent">
      <button class="closeBtn" onclick="document.getElementById('participantListModal').style.display='none'" aria-label="Fechar lista de participantes">Ã—</button>
      <div id="participantList"></div>
    </div>
  </div>

  <div id="playlistModal">
    <div id="playlistContent">
      <button class="closeBtn" onclick="document.getElementById('playlistModal').style.display='none'" aria-label="Fechar lista de reproduÃ§Ã£o">Ã—</button>
      <div id="playlistItems"></div>
    </div>
  </div>

  <audio id="memeSound" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg" preload="auto"></audio>

  <script>
    let isCreatingRoom = false;
    let myName = '';
    let roomID = '';

    // Fake state for demo purposes
    let isAdmin = false;  // hardcode pra testes, true para admin
    let approvalTimeout = null;

    // Dados da playlist e participantes (vazios inicialmente)
    const playlist = [];
    const participants = [];

    // FunÃ§Ã£o para atualizar a lista de participantes (sem nomes de exemplo)
    function updateParticipantList() {
      const list = document.getElementById('participantList');
      list.innerHTML = '';
      participants.forEach(p => {
        const div = document.createElement('div');
        div.className = 'playlistItem';
        div.textContent = p.name + (p.isAdmin ? ' (admin)' : '');
        list.appendChild(div);
      });
      if(participants.length === 0) {
        list.textContent = 'Nenhum participante na sala.';
      }
    }

    // FunÃ§Ã£o para atualizar a playlist (sem nomes de exemplo)
    function updatePlaylist() {
      const list = document.getElementById('playlistItems');
      list.innerHTML = '';
      playlist.forEach(item => {
        const div = document.createElement('div');
        div.className = 'playlistItem';
        const span = document.createElement('span');
        span.textContent = item.name;
        const small = document.createElement('small');
        small.textContent = `${item.type.toUpperCase()} - adicionado por ${item.addedBy}`;
        div.appendChild(span);
        div.appendChild(small);
        list.appendChild(div);
      });
      if(playlist.length === 0) {
        list.textContent = 'Playlist vazia.';
      }
    }

    // BotÃµes da interface

    document.getElementById('chooseMediaBtn').onclick = () => {
      document.getElementById('fileMenuModal').style.display = 'flex';
    };

    document.getElementById('showParticipantsBtn').onclick = () => {
      updateParticipantList();
      document.getElementById('participantListModal').style.display = 'flex';
    };

    document.getElementById('showPlaylistBtn').onclick = () => {
      updatePlaylist();
      document.getElementById('playlistModal').style.display = 'flex';
    };

    // MÃ­dia: escolher arquivo do dispositivo
    document.getElementById('selectFileBtn').onclick = () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'video/*,audio/*';
      input.onchange = () => {
        const file = input.files[0];
        if (file) {
          const url = URL.createObjectURL(file);
          const player = document.getElementById('mediaPlayer');
          player.srcObject = null;
          player.src = url;
          player.play();

          // Adiciona na playlist
          playlist.push({
            name: file.name,
            type: file.type.split('/')[1] || 'arquivo',
            addedBy: myName
          });
          updatePlaylist();

          document.getElementById('fileMenuModal').style.display = 'none';
        }
      };
      input.click();
    };

    // Inserir link
    document.getElementById('insertLinkBtn').onclick = () => {
      const url = prompt('Insira o link do vÃ­deo ou Ã¡udio:');
      if (!url) return;
      const extOK = /\.(mp4|webm|ogg|mp3|wav)(\?.*)?$/.test(url);
      if (!extOK && !url.startsWith('https://')) return alert('Link invÃ¡lido');
      const video = document.getElementById('mediaPlayer');
      video.srcObject = null;
      video.src = url;
      video.play();

      // Adiciona na playlist
      playlist.push({
        name: url.split('/').pop().split('?')[0],
        type: 'link',
        addedBy: myName
      });
      updatePlaylist();

      document.getElementById('fileMenuModal').style.display = 'none';
    };

    // Compartilhar tela
    document.getElementById('shareScreenBtn').onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
        const video = document.getElementById('mediaPlayer');
        video.srcObject = stream;
        video.play();
        document.getElementById('fileMenuModal').style.display = 'none';
      } catch (err) {
        alert('Erro ao compartilhar tela: ' + err);
      }
    };

    // Criar ou entrar na sala
    document.getElementById('createRoom').onclick = () => {
      isCreatingRoom = true;
      document.getElementById('menuSetup').style.display = 'none';
      document.getElementById('namePrompt').style.display = 'flex';
      roomID = Math.random().toString(36).substring(2,6).toUpperCase();
      isAdmin = true; // Quem cria Ã© admin
    };

    document.getElementById('joinRoom').onclick = () => {
      isCreatingRoom = false;
      document.getElementById('menuSetup').style.display = 'none';
      document.getElementById('namePrompt').style.display = 'flex';
      isAdmin = false;
    };

    // VariÃ¡vel para saber se jÃ¡ pediu aprovaÃ§Ã£o
    let waitingForApproval = false;

    document.getElementById('enterRoom').onclick = () => {
      myName = document.getElementById('nickname').value.trim();
      if (!myName) {
        alert('Por favor, insira seu nome de usuÃ¡rio.');
        return;
      }

      // Se criou sala, entra direto
      if (isCreatingRoom) {
        participants.push({name: myName, isAdmin: true});
        alert(`Sala criada! CÃ³digo: ${roomID}\nVocÃª Ã© o administrador.`);
        document.getElementById('namePrompt').style.display = 'none';
        document.getElementById('mainUI').style.display = 'flex';
        updateParticipantList();
        updatePlaylist();

        // Mostrar cÃ³digo da sala no chat
        const chatLog = document.getElementById('chatLog');
        const systemMsg = document.createElement('p');
        systemMsg.style.fontStyle = 'italic';
        systemMsg.style.color = '#aaa';
        systemMsg.textContent = `[Sistema: CÃ³digo da Sala (${roomID})]`;
        chatLog.appendChild(systemMsg);
        chatLog.scrollTop = chatLog.scrollHeight;

      } else {
        // Se entrou numa sala, pede aprovaÃ§Ã£o do admin
        document.getElementById('namePrompt').style.display = 'none';
        document.getElementById('waitingApproval').style.display = 'flex';
        waitingForApproval = true;

        // Tocar som meme ao pedir entrada
        document.getElementById('memeSound').play();

        // Simular pedido pro admin aceitar/rejeitar em 3 segundos (demo)
        if(approvalTimeout) clearTimeout(approvalTimeout);
        approvalTimeout = setTimeout(() => {
          // Simulando aprovaÃ§Ã£o ou rejeiÃ§Ã£o aleatÃ³ria
          const aprovado = confirm(`O administrador da sala ${roomID} aceita sua entrada, ${myName}? Clique OK para sim, Cancelar para recusar.`);
          document.getElementById('waitingApproval').style.display = 'none';
          waitingForApproval = false;

          if (aprovado) {
            participants.push({name: myName, isAdmin: false});
            document.getElementById('mainUI').style.display = 'flex';
            updateParticipantList();
            updatePlaylist();
          } else {
            document.getElementById('rejectedNotice').style.display = 'flex';
          }
        }, 3000);
      }
    };

    // BotÃ£o tentar novamente apÃ³s recusa
    document.getElementById('retryEntryBtn').onclick = () => {
      document.getElementById('rejectedNotice').style.display = 'none';
      document.getElementById('namePrompt').style.display = 'flex';
      document.getElementById('nickname').focus();
    };

    // Enviar mensagem do chat
    function sendMessage() {
      const input = document.getElementById('chatInput');
      const msg = input.value.trim();
      if(!msg) return;
      const chatLog = document.getElementById('chatLog');
      const p = document.createElement('p');
      p.textContent = `${myName}: ${msg}`;
      chatLog.appendChild(p);
      chatLog.scrollTop = chatLog.scrollHeight;
      input.value = '';
    }

    document.getElementById('sendChatBtn').onclick = sendMessage;

    // Enviar mensagem ao apertar Enter (sem Shift)
    const chatInput = document.getElementById('chatInput');
    chatInput.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
VersÃ£o Beta ;-;
